<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
<link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css" />
<title>Servicios</title>
</head>
<body>
  <div class="container" id="vuejscrudapp">
    <div class="row">
      <div  style="background-color: rgb(252, 255, 56);" class="col-md-12 mt-5">
        <h1  class="text-center">QUICK SERVICES</h1>
        <hr />
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <!-- Agregar Registros-->
        <div> 
          <br>
          <b-button id="show-btn" @click="showModal('my-modal')"
            >Agregar Registros</b-button>
          <br>
          <br>
          <b-modal ref="my-modal" hide-footer title="Agregar Registros">
            <div>
              <form action="" @submit.prevent="onSubmit">
                <div class="form-group">
                  <label for="">Nombre</label>
                  <input type="text" v-model="firstname" class="form-control" />
                </div>
                <div class="form-group">
                  <label for="">Tipo doc</label>
                  <input
                    type="text"
                    v-model="type_document"
                    class="form-control"
                  />
                </div>
                <div class="form-group">
                  <label for="">Documento</label>
                  <input
                    type="number"
                    v-model="document"
                    class="form-control"
                  />
                </div>
                <div class="form-group">
                  <label for="">Correo</label>
                  <input type="email" v-model="email" class="form-control" />
                </div>
                <div class="form-group">
                  <label for="">Telefono</label>
                  <input type="number" v-model="phone" class="form-control" />
                </div>
                <div class="form-group">
                  <label for="">Direccion</label>
                  <input type="text" v-model="address" class="form-control" />
                </div>
                <div class="form-group">
                  <label for="">Ciudad</label>
                  <input type="text" v-model="city" class="form-control" />
                </div>
                <br>
                <div class="form-group">
                  <label for="">Estados:</label>
                  <select>
                    <option value="opcion1">Finalizado</option>
                    <option value="opcion2">Pendiente</option>
                    <option value="opcion3">Listado</option>
                  </select>
                </div>
                <br>

                <div class="form-group">
                  <button class="btn btn-sm btn-outline-info">
                    Agregar Registros
                  </button>
                </div>
              </form>
            </div>
            <b-button
              class="mt-3"
              variant="outline-danger"
              block
              @click="hideModal('my-modal')"
              >Cerrar</b-button
            >
          </b-modal>
        </div>

        <!-- Actualizar Registros -->
        <div>
          <b-modal ref="my-modal1" hide-footer title="Update Record">
            <div>
              <form action="" @submit.prevent="onUpdate">
                <div class="form-group">
                  <label for="">Nombre</label>
                  <input
                    type="text"
                    v-model="edit_firstname"
                    class="form-control"
                  />
                </div>
                <div class="form-group">
                  <label for="">Tipo doc</label>
                  <input
                    type="text"
                    v-model="edit_type_document"
                    class="form-control"
                  />
                </div>
                <div class="form-group">
                  <label for="">Documento</label>
                  <input
                    type="number"
                    v-model="edit_document"
                    class="form-control"
                  />
                </div>
                <div class="form-group">
                  <label for="">Correo</label>
                  <input
                    type="email"
                    v-model="edit_email"
                    class="form-control"
                  />
                </div>
                <div class="form-group">
                  <label for="">Telefono</label>
                  <input
                    type="number"
                    v-model="edit_phone"
                    class="form-control"
                  />
                </div>
                <div class="form-group">
                  <label for="">Direccion</label>
                  <input
                    type="text"
                    v-model="edit_address"
                    class="form-control"
                  />
                </div>
                <div class="form-group">
                  <label for="">Ciudad</label>
                  <input type="text" v-model="edit_city" class="form-control" />
                </div>
                <div class="form-group">
                  <button class="btn btn-sm btn-outline-info">
                    Actualizar Registros
                  </button>
                </div>
              </form>
            </div>
            <b-button
              class="mt-3"
              variant="outline-danger"
              block
              @click="hideModal('my-modal1')"
              >Cerrar</b-button
            >
          </b-modal>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <table class="table table-striped table-bordered" S>
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Tipo doc</th>
              <th>Documento</th>
              <th>Correo</th>
              <th>Telefono</th>
              <th>Direccion</th>
              <th>Ciudad</th>
              <th>Estados</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(record, i) in records" :key="record.id">
              <td>{{ i + 1 }}</td>
              <td>{{ record.firstname }}</td>
              <td>{{ record.type_document }}</td>
              <td>{{ record.document }}</td>
              <td>{{ record.email }}</td>
              <td>{{ record.phone }}</td>
              <td>{{ record.address }}</td>
              <td>{{ record.city }}</td>
              <td>
                <button
                  @click="deleteRecord(record.id)"
                  class="btn btn-sm btn-outline-danger"
                >
                  Borrar
                </button>
                <button
                  @click="editRecord(record.id)"
                  class="btn btn-sm btn-outline-info"
                >
                  Edit
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<!-- BootstrapVue js -->
<script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>
<!-- Axios -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
var app = new Vue({
  el: "#vuejscrudapp",
  data: {
    firstname: "",
    type_document: "",
    document: "",
    email: "",
    phone: "",
    address: "",
    city: "",
    records: [],
    edit_id: "",
    edit_firstname: "",
    edit_type_document: "",
    edit_document: "",
    edit_email: "",
    edit_phone: "",
    edit_address: "",
    edit_city: "",
  },

  methods: {
    showModal(id) {
      this.$refs[id].show();
    },
    hideModal(id) {
      this.$refs[id].hide();
    },

    onSubmit() {
      if (
        this.firstname !== "" &&
        this.type_document !== "" &&
        this.document !== "" &&
        this.email !== "" &&
        this.phone !== "" &&
        this.address !== "" &&
        this.city !== ""
      ) {
        var config = {
          headers: {
            "Content-Type": "application/json",
            "Access-Control-Allow-Origin": "*",
          },
        };
        axios
          .post(
            "http://127.0.0.1:8080/insert",
            {
              firstname: this.firstname,
              type_document: this.type_document,
              document: this.document,
              email: this.email,
              phone: this.phone,
              address: this.address,
              city: this.city,
            },
            config
          )
          .then((res) => {
            console.log(res);
            alert("New record Successfully added");
            this.firstname = "";
            this.type_document = "";
            this.email = "";
            this.phone = "";
            this.address = "";
            this.city = "";

            app.hideModal("my-modal");
            app.getRecords();
          })
          .catch((err) => {
            console.log(err);
          });
      } else {
        alert("Agregado");
      }
    },

    getRecords() {
      axios({
        url: "http://localhost:8080//",
        method: "get",
      })
        .then((res) => {
          console.log(res);
          this.records = res.data.members;
        })
        .catch((err) => {
          console.log(err);
        });
    },

    editRecord(id) {
      axios
        .get("http://127.0.0.1:8080/edit/" + id)
        .then((res) => {
          console.log(res.data);
          this.edit_id = res.data.editmember["id"];
          this.edit_firstname = res.data.editmember["firstname"];
          this.edit_type_document = res.data.editmember["type_document"];
          this.document = res.data.editmember["document"];
          this.edit_email = res.data.editmember["email"];
          this.edit_phone = res.data.editmember["phone"];
          this.edit_address = res.data.editmember["address"];
          this.edit_city = res.data.editmember["city"];
          app.showModal("my-modal1");
        })
        .catch((err) => {
          console.log(err);
        });
    },

    onUpdate() {
      if (
        this.edit_firstname !== "" &&
        this.edit_type_document !== "" &&
        this.edit_document !== "" &&
        this.edit_email !== "" &&
        this.edit_phone !== "" &&
        this.edit_address !== "" &&
        this.edit_city !== ""
      ) {
        var config = {
          headers: {
            "Content-Type": "application/json",
            "Access-Control-Allow-Origin": "*",
          },
        };
        axios
          .post(
            "http://127.0.0.1:5000/update",
            {
              edit_id: this.edit_id,
              edit_firstname: this.edit_firstname,
              edit_type_document: this.edit_type_document,
              edit_document: this.edit_document,
              edit_email: this.edit_email,
              edit_phone: this.edit_phone,
              edit_address: this.edit_address,
              edit_city: this.edit_city,
            },
            config
          )
          .then((res) => {
            console.log(res);
            alert("record update");

            this.edit_firstname = "";
            this.edit_type_document = "";
            this.edit_document = "";
            this.edit_email = "";
            this.edit_phone = "";
            this.edit_address = "";
            this.edit_city = "";
            this.edit_id = "";

            app.hideModal("my-modal1");
            app.getRecords();
          })
          .catch((err) => {
            console.log(err);
          });
      } else {
        alert("listo");
      }
    },

    deleteRecord(id) {
      if (window.confirm("Delete this record")) {
        axios
          .get("http://127.0.0.1:8080/delete/" + id)
          .then((res) => {
            console.log(res);
            alert("delete successfully");
            app.getRecords();
          })
          .catch((err) => {
            console.log(err);
          });
      }
    },
  },

  mounted: function () {
    this.getRecords();
  },
});
</script>
<style>
   body{ 
  font-family: Avenir, Helvetica, Arial, sans-serif;
  align-items: center;
  color: #000000;
  margin-top: auto;
  background-color: white;
   }
</style>
</body>
</html>
